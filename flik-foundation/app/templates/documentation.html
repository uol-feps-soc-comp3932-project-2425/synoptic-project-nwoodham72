{% extends "base.html" %}
{% block title %}Flik - Documentation{% endblock %}

{% block content %}
<h2 class="mb-4">Manage your Documentation</h2>
<p class="text-muted">You must have at least one role and page defined to allow users to report bugs.</p>

<!-- ------------------------- -->
<!-- Add New Role -->
<!-- ------------------------- -->
<h4>Application Roles</h4>
<p class="text-muted">These roles are used when users report bugs (e.g. Lecturer, Student, etc.).</p>

<form method="POST" action="{{ url_for('runbook.add_application_role') }}" class="mb-4">
    <div class="input-group">
        <input type="text" name="role_name" class="form-control" placeholder="Enter new role name" required>
        <button class="btn btn-success" type="submit">Add Role</button>
    </div>
</form>

<!-- ------------------------- -->
<!-- List Roles -->
<!-- ------------------------- -->
{% if application_roles %}
    <h5>Existing Roles:</h5>
    <ul class="list-group">
        {% for application_role in application_roles %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <form class="d-flex flex-grow-1" method="POST" action="{{ url_for('runbook.update_application_role', application_role_id=application_role.id) }}">
                    <input name="new_name" class="form-control me-2" value="{{ application_role.name }}" required>
                    <button class="btn btn-outline-primary" type="submit">Update</button>
                </form>

                <form method="POST" action="{{ url_for('runbook.delete_application_role', application_role_id=application_role.id) }}" class="ms-2">
                    <button class="btn btn-outline-danger" onclick="return confirm('Delete this role?')" type="submit">Delete</button>
                </form>
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p class="text-muted"><i>No roles defined.</i></p>
{% endif %}

<hr class="my-5">

<!-- ------------------------- -->
<!-- Add New Page -->
<!-- ------------------------- -->
<h4>Application Pages</h4>
<p class="text-muted">These pages are used when users report bugs (e.g. Login, Dashboard, etc.).</p>

<form method="POST" action="{{ url_for('runbook.add_application_page') }}" class="mb-4">
    <div class="input-group">
        <input type="text" name="page_name" class="form-control" placeholder="Enter new page name" required>
        <button class="btn btn-success" type="submit">Add Page</button>
    </div>
</form>

<!-- ------------------------- -->
<!-- List Pages -->
<!-- ------------------------- -->
{% if application_pages %}
    <h5>Existing Pages:</h5>
    <ul class="list-group">
        {% for application_page in application_pages %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <form class="d-flex flex-grow-1" method="POST" action="{{ url_for('runbook.update_application_page', application_page_id=application_page.id) }}">
                    <input name="new_name" class="form-control me-2" value="{{ application_page.name }}" required>
                    <button class="btn btn-outline-primary" type="submit">Update</button>
                </form>

                <form method="POST" action="{{ url_for('runbook.delete_application_page', application_page_id=application_page.id) }}" class="ms-2">
                    <button class="btn btn-outline-danger" onclick="return confirm('Delete this page?')" type="submit">Delete</button>
                </form>
                
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p class="text-muted"><i>No pages defined.</i></p>
{% endif %}

<hr class="my-5">

<!-- ------------------------- -->
<!-- Add New Rule -->
<!-- ------------------------- -->
<h4>Application Rules</h4>
<p class="text-muted">
    These rules define the functionality of your application.<br>
    A rule contains a title, description, roles that are able to perform the action and the area of functionality the action takes place in.
</p>

<form method="POST" action="{{ url_for('runbook.add_application_rule') }}" class="mb-4">
    {{ form.hidden_tag() }}
    <div class="mb-3">
        {{ form.title.label(class="form-label") }}
        {{ form.title(class="form-control") }}
    </div>
    <div class="mb-3">
        {{ form.description.label(class="form-label") }}
        {{ form.description(class="form-control") }}
    </div>
    <div class="mb-3">
        {{ form.page.label(class="form-label") }}
        {{ form.page(class="form-select") }}
    </div>
    <div class="mb-3">
        {{ form.roles.label(class="form-label") }}
        {{ form.roles(class="form-select", multiple="multiple", size="5") }}
        <small class="form-text text-muted">Hold Ctrl (CMD on Mac) to select multiple roles</small>
    </div>
    <button class="btn btn-success" type="submit">Add Rule</button>
</form>

<!-- ------------------------- -->
<!-- List Rules -->
<!-- ------------------------- -->
{% if application_rules %}
    <h5>Existing Rules:</h5>
    <ul class="list-group">
        {% for rule in application_rules %}
            <li class="list-group-item">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="mb-0">{{ rule.title }}</h5>
                    <!-- <div>
                        <a href="{{ url_for('runbook.edit_application_rule', rule_id=rule.id) }}" class="btn btn-outline-primary btn-sm">Edit</a>
                        <form class="d-inline" method="POST" action="{{ url_for('runbook.delete_application_rule', rule_id=rule.id) }}">
                            <button class="btn btn-outline-danger btn-sm" onclick="return confirm('Delete this rule?')" type="submit">Delete</button>
                        </form>
                    </div> -->
                </div>
                <p>{{ rule.description }}</p>
                <!-- <div class="d-flex justify-content-between small">
                    <div>
                        <strong>Page:</strong> {{ rule.page.name if rule.page else 'None' }}
                    </div>
                    <div>
                        <strong>Role(s) permitted to perform the action:</strong> 
                        {% for role in rule.roles %}
                            <span class="badge bg-secondary me-1">{{ role.name }}</span>
                        {% endfor %}
                    </div>
                </div> -->
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p class="text-muted"><i>No rules defined.</i></p>
{% endif %}

<hr class="my-5">

{% endblock %}
