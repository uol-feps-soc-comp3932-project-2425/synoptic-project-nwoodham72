{% extends "base.html" %}
{% block title %}Flik - Documentation{% endblock %}

{% block content %}
<h2 class="mb-4">Manage your Documentation</h2>
<p class="text-muted">You must have at least one role and page defined to allow users to report bugs.</p>

<!-- ------------------------- -->
<!-- Add New Role -->
<!-- ------------------------- -->
<h4>Application Roles</h4>
<p class="text-muted">These roles are used when users report bugs (e.g. Lecturer, Student, etc.).</p>

<form method="POST" action="{{ url_for('runbook.add_application_role') }}" class="mb-4">
    <div class="input-group">
        <input type="text" name="role_name" class="form-control" placeholder="Enter new role name" required>
        <button class="btn btn-success" type="submit">Add Role</button>
    </div>
</form>

<!-- ------------------------- -->
<!-- List Roles -->
<!-- ------------------------- -->
{% if application_roles %}
    <h5>Existing Roles:</h5>
    <ul class="list-group">
        {% for application_role in application_roles %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <form class="d-flex flex-grow-1" method="POST" action="{{ url_for('runbook.update_application_role', application_role_id=application_role.id) }}">
                    <input name="new_name" class="form-control me-2" value="{{ application_role.name }}" required>
                    <button class="btn btn-outline-primary" type="submit">Update</button>
                </form>

                <form method="POST" action="{{ url_for('runbook.delete_application_role', application_role_id=application_role.id) }}" class="ms-2">
                    <button class="btn btn-outline-danger" onclick="return confirm('Delete this role?')" type="submit">Delete</button>
                </form>
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p class="text-muted"><i>No roles defined.</i></p>
{% endif %}

<hr class="my-5">

<!-- ------------------------- -->
<!-- Add New Page -->
<!-- ------------------------- -->
<h4>Application Pages</h4>
<p class="text-muted">These pages are used when users report bugs (e.g. Login, Dashboard, etc.).</p>

<form method="POST" action="{{ url_for('runbook.add_application_page') }}" class="mb-4">
    <div class="input-group">
        <input type="text" name="page_name" class="form-control" placeholder="Enter new page name" required>
        <button class="btn btn-success" type="submit">Add Page</button>
    </div>
</form>

<!-- ------------------------- -->
<!-- List Pages -->
<!-- ------------------------- -->
{% if application_pages %}
    <h5>Existing Pages:</h5>
    <ul class="list-group">
        {% for application_page in application_pages %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <form class="d-flex flex-grow-1" method="POST" action="{{ url_for('runbook.update_application_page', application_page_id=application_page.id) }}">
                    <input name="new_name" class="form-control me-2" value="{{ application_page.name }}" required>
                    <button class="btn btn-outline-primary" type="submit">Update</button>
                </form>

                <form method="POST" action="{{ url_for('runbook.delete_application_page', application_page_id=application_page.id) }}" class="ms-2">
                    <button class="btn btn-outline-danger" onclick="return confirm('Delete this page?')" type="submit">Delete</button>
                </form>
                
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p class="text-muted"><i>No pages defined.</i></p>
{% endif %}

<hr class="my-5">

<!-- ------------------------- -->
<!-- Add New Rule -->
<!-- ------------------------- -->
<h4>Application Rules</h4>
<p class="text-muted">
    These rules define the functionality of your application.<br>
    A rule contains a title, description, roles that are able to perform the action and the area of functionality the action takes place in.
</p>

<form method="POST" action="{{ url_for('runbook.add_application_rule', application_rule_id=application_rule_id) }}"">
    {{ form.hidden_tag() }}
  
    <!-- Title Input -->
    <div class="mb-3">
      <label class="form-label">Rule Title</label>
      <div class="input-group">
        {{ form.title(class="form-control", placeholder="Enter rule title") }}
      </div>
    </div>
  
    <!-- Description Input -->
    <div class="mb-3">
      <label class="form-label">Description</label>
      <div class="input-group">
        {{ form.description(class="form-control", rows=2, placeholder="Describe what this rule does") }}
      </div>
    </div>
  
    <!-- Page Select -->
    <div class="mb-3">
      <label class="form-label">Select Page</label>
      <div class="input-group">
        {{ form.page(class="form-select") }}
      </div>
    </div>
  
    <!-- Permitted Roles Multi-Select -->
    <div class="mb-3">
      <label class="form-label">Permitted Roles</label>
      <div class="input-group">
        {{ form.roles(class="form-select", multiple=True, size=5) }}
      </div>
      <small class="form-text text-muted">Hold Ctrl (CMD on Mac) to select multiple roles</small>
    </div>
  
    <!-- Submit -->
    <div class="mb-3">
      <button type="submit" class="btn btn-success">Add Rule</button>
    </div>
  </form>
  

<!-- ------------------------- -->
<!-- List Rules -->
<!-- ------------------------- -->
{% if application_rules %}
    <h5 class="mb-3">Existing Rules:</h5>
    {% if application_rules %}
        <div class="row row-cols-1 row-cols-md-3 g-4">
            {% for rule in application_rules %}
                <div class="col">
                <div class="card shadow-sm h-100">
                    <div class="card-body">
                    <h5 class="card-title">{{ rule.title }}</h5>
                    <h6 class="card-subtitle mb-2 text-muted">{{ rule.page.name }}</h6>
                    <p class="card-text">{{ rule.description }}</p>
                    <div class="mb-3">
                        {% for role in rule.roles %}
                        <span class="badge bg-secondary">{{ role.name }}</span>
                        {% endfor %}
                    </div>
                    <a href="#" class="btn btn-outline-primary btn-sm disabled">Update</a>
                    </div>
                </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
    <p class="fst-italic text-muted">No rules defined.</p>
    {% endif %}
{% endif %}


<hr class="my-5">

{% endblock %}
